(function(n){"use strict";n.fn.pin=function(t){var u=0,i=[],e=!1,r=n(window);t=t||{};var f=function(){for(var u,o,f=0,c=i.length;f<c;f++){if(u=i[f],t.minWidth&&r.width()<=t.minWidth){u.parent().is(".pin-wrapper")&&u.unwrap();u.css({width:"",left:"",top:"",position:""});t.activeClass&&u.removeClass(t.activeClass);e=!0;continue}else e=!1;var s=t.containerSelector?u.closest(t.containerSelector):n(document.body),l=u.offset(),h=s.offset(),a=u.offsetParent().offset();u.parent().is(".pin-wrapper")||u.wrap("<div class='pin-wrapper'>");o=n.extend({top:0,bottom:0},t.padding||{});u.data("pin",{pad:o,from:(t.containerSelector?h.top:l.top)-o.top,to:h.top+s.height()-u.outerHeight()-o.bottom,end:h.top+s.height(),parentTop:a.top});u.css({width:u.outerWidth()});u.parent().css("height",u.outerHeight())}},o=function(){var c,s,a,f,o,l,h;if(!e){for(u=r.scrollTop(),c=[],s=0,a=i.length;s<a;s++)if(f=n(i[s]),o=f.data("pin"),o){if(c.push(f),l=o.from-o.pad.bottom,h=o.to-o.pad.top,l+f.outerHeight()>o.end){f.css("position","");continue}l<u&&h>u?(f.css("position")=="fixed"||f.css({left:f.offset().left,top:o.pad.top}).css("position","fixed"),t.activeClass&&f.addClass(t.activeClass)):u>=h?(f.css({left:"",top:h-o.parentTop+o.pad.top}).css("position","absolute"),t.activeClass&&f.addClass(t.activeClass)):(f.css({position:"",top:"",left:""}),t.activeClass&&f.removeClass(t.activeClass))}i=c}},s=function(){f();o()};return this.each(function(){var r=n(this),t=n(this).data("pin")||{};if(!t||!t.update){i.push(r);n("img",this).one("load",f);t.update=s;n(this).data("pin",t)}}),r.scroll(o),r.resize(function(){f()}),f(),r.load(s),this}})(jQuery)